# Prove v0.6 — Core Stdlib

## Goal

The three data modules the self-hosted compiler needs most: character
classification, string operations, and hash tables. Each is a `.prv`
file declaring types and function signatures, backed by a C
implementation that the Python compiler links in.

**Prerequisite:** v0.5 (turbo runtime) must be complete — Table uses
the fast hash, and Builder can use the arena internally.

---

## Modules

### 1. `Character` — Character Classification

Focused on the Character type: classifying individual characters and
extracting characters from strings.

```prove
module Character
  narrative: "Character classification and access."
```

| Function | Signature | C backing |
|----------|-----------|-----------|
| `alpha` | `validates alpha(c Character) Boolean` | `isalpha()` |
| `digit` | `validates digit(c Character) Boolean` | `isdigit()` |
| `alnum` | `validates alnum(c Character) Boolean` | `isalnum()` |
| `upper` | `validates upper(c Character) Boolean` | `isupper()` |
| `lower` | `validates lower(c Character) Boolean` | `islower()` |
| `space` | `validates space(c Character) Boolean` | `isspace()` |
| `at` | `reads at(s String, i Integer) Character` | Index into string |

**C file:** `prove_character.c/h` (~40 lines)

---

### 2. `Text` — String Operations and Construction

String querying, transformation, and building. Every function operates
on String or Builder — no Character classification here.

```prove
module Text
  narrative: "String operations and construction."

  type Builder is binary
```

| Function | Signature | C backing |
|----------|-----------|-----------|
| `length` | `reads length(s String) Integer` | `strlen()` |
| `slice` | `transforms slice(s String, start Integer, end Integer) String` | Substring copy |
| `starts_with` | `validates starts_with(s String, prefix String) Boolean` | `strncmp` |
| `ends_with` | `validates ends_with(s String, suffix String) Boolean` | Compare tail |
| `contains` | `validates contains(s String, sub String) Boolean` | `strstr` |
| `index_of` | `reads index_of(s String, sub String) Option<Integer>` | `strstr` offset |
| `split` | `transforms split(s String, sep String) List<String>` | Split by separator |
| `join` | `transforms join(parts List<String>, sep String) String` | Join with separator |
| `trim` | `transforms trim(s String) String` | Strip whitespace |
| `to_lower` | `transforms to_lower(s String) String` | Lowercase copy |
| `to_upper` | `transforms to_upper(s String) String` | Uppercase copy |
| `replace` | `transforms replace(s String, old String, new String) String` | Replace all occurrences |
| `repeat` | `transforms repeat(s String, n Integer) String` | Repeat n times |
| `builder` | `creates builder() Builder` | Allocate growable buffer |
| `write` | `saves write(b Builder, s String) Builder` | Append string |
| `write_char` | `saves write_char(b Builder, c Character) Builder` | Append char |
| `build` | `reads build(b Builder) String` | Finalize to String |
| `builder_length` | `reads builder_length(b Builder) Integer` | Current length |

**C file:** `prove_text.c/h` (~200 lines)

---

### 3. `Table` — Hash Map

Needed for: symbol tables, keyword lookup, type registries, seen-sets,
builtin dispatch tables. The Python compiler uses `dict` everywhere.

Uses `prove_hash()` from v0.5 turbo runtime internally.

```prove
module Table
  narrative: "Hash table from String keys to values."

  type Table<V> is binary
```

| Function | Signature | C backing |
|----------|-----------|-----------|
| `new` | `creates new() Table<V>` | Allocate hash table |
| `has` | `validates has(key String, table Table<V>) Boolean` | Key exists check |
| `add` | `saves add(key String, value V, table Table<V>) Table<V>` | Insert/update |
| `get` | `reads get(key String, table Table<V>) Option<V>` | Lookup |
| `remove` | `saves remove(key String, table Table<V>) Table<V>` | Delete key |
| `keys` | `reads keys(table Table<V>) List<String>` | All keys |
| `values` | `reads values(table Table<V>) List<V>` | All values |
| `length` | `reads length(table Table<V>) Integer` | Entry count |

**C file:** `prove_table.c/h` (~250 lines) — open-addressing hash table
with `prove_hash()` for keys.

---

## Summary

| Module | Functions | C lines (est.) | Purpose |
|--------|-----------|----------------|---------|
| `Character` | 7 | 40 | Character classification |
| `Text` | 18 | 200 | String ops + Builder |
| `Table` | 8 | 250 | Hash map |
| **Total** | **33** | **~490** | |

---

## Deliverables

| Deliverable | Description |
|-------------|-------------|
| `prove_character.c/h` | C runtime for Character module |
| `prove_text.c/h` | C runtime for Text module |
| `prove_table.c/h` | C runtime for Table module |
| `stdlib/character.prv` | Prove type signatures |
| `stdlib/text.prv` | Prove type signatures |
| `stdlib/table.prv` | Prove type signatures |
| `c_runtime.py` | Register new runtime files |
| `stdlib_loader.py` | Register new stdlib modules |
| Tests | Unit tests for each C implementation |

---

## Verification

Write small `.prv` programs using each module, compile and run them
with the Python compiler. Each program exercises the module's full API.
