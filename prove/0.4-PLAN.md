# Prove v0.4 — Language Features

## Goal

Add the language features the compiler stdlib and self-hosted compiler
need. These are changes to the bootstrap Python compiler (lexer, parser,
checker, emitter).

**Prerequisite:** v0.3 (legacy stdlib cleanup) must be complete.

---

## Features

### 1. Pure Verbs — `reads`, `creates`, `saves`

Three new verbs in the pure family. Like `transforms`, they describe
data operations but with more specific intent. No new syntax needed —
they are standalone verbs, just like `inputs`, `outputs`, `validates`,
and `transforms`.

```prove
creates new() Table<V>
reads get(key String, table Table<V>) Option<V>
saves add(key String, value V, table Table<V>) Table<V>
```

**Affected modules:**
- `tokens.py` — add `READS`, `CREATES`, `SAVES` to `TokenKind` and `KEYWORDS`
- `lexer.py` — no changes (keywords are already handled generically)
- `parser.py` — accept new verb tokens in `_parse_function_def()`
- `checker.py` — allow new verbs in verb validation
- `c_emitter.py` — include verb in name mangling (already works generically)

---

### 2. Namespaced Function Calls — `Module.function()`

Allow calling imported functions with their module name as prefix.
Requires explicit import — unimported functions are errors.

```prove
module Compiler
  Table creates new, reads get

  // Both forms valid after import:
  table as Table<String> = Table.new()
  value as Option<String> = Table.get("key", table)
```

**Affected modules:**
- `parser.py` — parse `TypeIdentifier.identifier(args)` as namespaced call
- `checker.py` — resolve module-qualified function names against imports
- `c_emitter.py` — emit same mangled name regardless of call style

---

### 3. Binary Types — `type X is binary`

Declare types backed by C implementations. No Prove-visible fields.
Interacted with only through module functions.

```prove
type Table<V> is binary
type StringBuilder is binary
```

**Affected modules:**
- `parser.py` — parse `binary` as a type body variant
- `ast_nodes.py` — add `BinaryDef` to `TypeBody`
- `checker.py` — binary types cannot be constructed or destructured in Prove
- `c_emitter.py` — emit as opaque pointer typedef

---

### 4. Channel-Based Verb Dispatch

Same function name with different verbs, dispatched by call context.
Already partially supported — needs verification and hardening.

```prove
// In InputOutput: same name 'file', different verbs
inputs file(path String) String!
outputs file(path String, content String)!
validates file(path String) Boolean
```

**Affected modules:**
- `checker.py` — resolve overloads by verb + arity
- `c_emitter.py` — mangle names to include verb

---

## Deliverables

| Deliverable | Description |
|-------------|-------------|
| Pure verbs (reads, creates, saves) | Tokens, parser, checker changes |
| Namespaced calls | Parser, checker, emitter changes |
| Binary type support | Parser, AST, checker, emitter changes |
| Channel dispatch | Checker, emitter hardening |
| Tests | Unit tests for each feature |

---

## Verification

- All existing tests pass (no regressions)
- New tests for each feature
- Small `.prv` programs exercising pure verbs, namespaced calls,
  binary types, and channel dispatch compile and run correctly
